<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SalesPulse V5 | Live Production</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root { --bg: #0b0f1a; --card: #161b2b; --accent: #0ea5e9; --text: #f1f5f9; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; flex-direction: column; }
        
        /* Centered Login */
        #login-container { display: flex; justify-content: center; align-items: center; flex-grow: 1; }
        .login-card { background: var(--card); padding: 40px; border-radius: 12px; border: 1px solid #2d3748; text-align: center; width: 320px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        input { width: 100%; padding: 12px; margin: 15px 0; border-radius: 8px; border: 1px solid #334155; background: #1e293b; color: white; box-sizing: border-box; }
        button { background: var(--accent); color: white; border: none; padding: 12px 20px; border-radius: 6px; font-weight: bold; cursor: pointer; width: 100%; }

        /* Dashboard Content */
        #dashboard-main { display: none; padding: 25px; width: 100%; box-sizing: border-box; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        .metric-card { background: var(--card); padding: 20px; border-radius: 10px; border-left: 5px solid var(--accent); }
        .metric-card h3 { margin: 0; color: #94a3b8; font-size: 0.9rem; }
        .metric-card p { font-size: 2.2rem; margin: 10px 0 0; font-weight: bold; color: var(--accent); }
        .chart-box { background: var(--card); padding: 20px; border-radius: 10px; height: 450px; border: 1px solid #2d3748; }
    </style>
</head>
<body>

    <div id="login-container">
        <div class="login-card">
            <h1 style="margin-top:0;">SalesPulse V5</h1>
            <input type="password" id="access-code" placeholder="Password (1234)">
            <button onclick="handleLogin()">ENTER DASHBOARD</button>
            <p id="err" style="color: #ef4444; margin-top: 15px; font-size: 0.8rem;"></p>
        </div>
    </div>

    <div id="dashboard-main">
        <header style="margin-bottom: 30px; border-bottom: 1px solid #2d3748; padding-bottom: 10px;">
            <h1 style="margin:0;">Corporate Sales Intelligence</h1>
            <p style="color: #64748b; margin: 5px 0 0;">Live Anker Performance Data</p>
        </header>

        <div class="stats-grid">
            <div class="metric-card"><h3>NET REVENUE (OMR)</h3><p id="rev-val">0.00</p></div>
            <div class="metric-card"><h3>TOTAL UNITS</h3><p id="unit-val">0</p></div>
        </div>

        <div class="chart-box">
            <canvas id="execChart"></canvas>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const SB_URL = 'https://iyxpvbvpampykfjffgol.supabase.co'; 
        const SB_KEY = 'sb_publishable_Q9IcqOv5IU9boMcm5fnG_w_je4xqV46';
        const client = supabase.createClient(SB_URL, SB_KEY);

        // --- AUTHENTICATION ---
        async function handleLogin() {
            const code = document.getElementById('access-code').value;
            if (code === '1234') { //
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('dashboard-main').style.display = 'block';
                document.body.style.display = 'block'; // Reset flex centering
                loadDashboardData();
            } else {
                document.getElementById('err').innerText = "Incorrect Password.";
            }
        }

        // --- DATA ENGINE ---
        async function loadDashboardData() {
            try {
                const { data, error } = await client
                    .from('sales_data')
                    .select('payload')
                    .eq('id', 1)
                    .single();

                if (error) throw error;
                const p = data.payload;

                // Update Metrics
                document.getElementById('rev-val').innerText = p.total_revenue.toLocaleString();
                document.getElementById('unit-val').innerText = p.total_units.toLocaleString();

                // Render Executive Chart (Anas, Suhail, Salam, Manseer)
                new Chart(document.getElementById('execChart'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(p.individual_sales),
                        datasets: [{ 
                            label: 'Sales by Executive (OMR)', 
                            data: Object.values(p.individual_sales), 
                            backgroundColor: '#0ea5e9' 
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false,
                        scales: { y: { beginAtZero: true, grid: { color: '#2d3748' } } }
                    }
                });
            } catch (err) {
                console.error("Dashboard Failed:", err.message);
                alert("Data failed to load. Check Supabase credentials.");
            }
        }
    </script>
</body>
</html>